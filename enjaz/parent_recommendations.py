"""
Parent Recommendations Module for Enjaz Application.
Generates Arabic recommendations for parents based on student performance bands.
"""

from enjaz.analysis import get_band


def get_parent_recommendation(completion_rate):
    """
    Generate recommendation for parents based on student's completion rate.
    
    Args:
        completion_rate: Student's completion percentage (0-100)
    
    Returns:
        str: Arabic recommendation text for parents
    """
    band = get_band(completion_rate)
    
    recommendations = {
        "ุงูุจูุงุชูููุฉ": (
            "๐ **ุงููุฆุฉ ุงูุจูุงุชูููุฉ (90% โ 100%)**\n\n"
            "ุชูุธูุฑ ุงููุชุงุฆุฌ ุงูุชุฒุงููุง ูุฑุชูุนูุง ุฌุฏูุง ุจุญู ุงูุชููููุงุช ุงูุฃุณุจูุนูุฉ ุนูู ูุธุงู ูุทุฑ ููุชุนููู (ูุฆุฉ ุจูุงุชูููุฉ). "
            "ูุดูุฑ ุชุนุงููููุ ููููุตู ุจุงูุงุณุชูุฑุงุฑ ูู ุงูุฏุนู ูุงูุชุญููุฒ ููุญูุงุธ ุนูู ูุฐุง ุงููุณุชูู ุงููุชููุฒ."
        ),
        
        "ุงูุฐูุจูุฉ": (
            "๐ฅ **ุงููุฆุฉ ุงูุฐูุจูุฉ (75% โ ุฃูู ูู 90%)**\n\n"
            "ุชูุธูุฑ ุงููุชุงุฆุฌ ุงูุชุฒุงููุง ุฌูุฏูุง ุฌุฏูุง ููุฑูุจูุง ูู ูุณุชูู ุงูุงูุชูุงุฒ (ูุฆุฉ ุฐูุจูุฉ). "
            "ุฏุนููู ุงููุณุชูุฑ ููุนุฒูุฒ ุงููุตูู ุฅูู ุงูุชููุฒ ุงููุงูู."
        ),
        
        "ุงููุถูุฉ": (
            "๐ฅ **ุงููุฆุฉ ุงููุถูุฉ (60% โ ุฃูู ูู 75%)**\n\n"
            "ุงููุณุจุฉ ุงูุญุงููุฉ ุฌูุฏุฉ ูุชุนูุณ ุชูุฏูููุง ููุญูุธูุง (ูุฆุฉ ูุถูุฉ). "
            "ูููุตู ุจูุชุงุจุนุฉ ุฏูุฑูุฉ ูุชุดุฌูุน ูุณุชูุฑ ูุฑูุน ูุณุชูู ุงูุงูุชุฒุงู."
        ),
        
        "ุงูุจุฑููุฒูุฉ": (
            "๐ฅ **ุงููุฆุฉ ุงูุจุฑููุฒูุฉ (40% โ ุฃูู ูู 60%)**\n\n"
            "ุงููุณุจุฉ ูุชูุณุทุฉ ููุฎูุถุฉ (ูุฆุฉ ุจุฑููุฒูุฉ). "
            "ูููุตู ุจุชูุซูู ุงูุชุดุฌูุน ูุงูุชูุงุตู ุงูุฏูุฑู ูุฑูุน ูุณุชูู ุงูุงูุชุฒุงู ุจุญู ุงูุชููููุงุช."
        ),
        
        "ูุญุชุงุฌ ุฅูู ุชุทููุฑ": (
            "๐ง **ูุญุชุงุฌ ุฅูู ุชุทููุฑ (ุฃูู ูู 40%)**\n\n"
            "ุงููุณุจุฉ ุงูุญุงููุฉ ููุฎูุถุฉ ูุชุญุชุงุฌ ุฅูู ุฑูุน ููุญูุธ. "
            "ูููุตู ุจุฒูุงุฏุฉ ุงููุชุงุจุนุฉ ูุงูุชูุงุตู ุงููุณุชูุฑ ูุชูููู ุนุงุฏุงุช ููุชุธูุฉ ูู ุฅูุฌุงุฒ ุงูุชููููุงุช."
        ),
        
        "ูุง ูุณุชููุฏ ูู ุงููุธุงู": (
            "๐ซ **ูุง ูุณุชููุฏ ูู ุงููุธุงู / ูู ููุฌุฒ (0%)**\n\n"
            "ูุง ุชูุฌุฏ ุฅูุฌุงุฒุงุช ูุณุฌูุฉ ูู ุงูุชููููุงุช ุงูุฃุณุจูุนูุฉ ุญุชู ุงูุขู. "
            "ูููุตู ุจุชูุงุตู ุนุงุฌู ูุชุญููุฒ ูุจุงุดุฑ ููุจุฏุก ููุฑูุง ูู ุญู ุงูุชููููุงุช ุนูู ูุธุงู ูุทุฑ ููุชุนููู."
        )
    }
    
    return recommendations.get(band, "ูุง ุชูุฌุฏ ุชูุตูุงุช ูุชุงุญุฉ.")


def format_parent_communication_email(student_name, completion_rate, subjects_summary):
    """
    Format a complete email for parent communication.
    
    Args:
        student_name: Name of the student
        completion_rate: Overall completion percentage
        subjects_summary: List of dicts with subject details
    
    Returns:
        str: Formatted email text in Arabic
    """
    band = get_band(completion_rate)
    recommendation = get_parent_recommendation(completion_rate)
    
    email = f"""
ุงูุณูุงู ุนูููู ูุฑุญูุฉ ุงููู ูุจุฑูุงุชู

ููู ุฃูุฑ ุงูุทุงูุจ/ุฉ: {student_name}

ููุฏ ุฅุทูุงุนูู ุนูู ุฃุฏุงุก ุงูุทุงูุจ/ุฉ ูู ุงูุชููููุงุช ุงูุฃุณุจูุนูุฉ ุนูู ูุธุงู ูุทุฑ ููุชุนููู:

**ูุณุจุฉ ุงูุฅูุฌุงุฒ ุงูุฅุฌูุงููุฉ:** {completion_rate:.1f}%
**ุงููุฆุฉ:** {band}

---

**ุชูุงุตูู ุงูุฃุฏุงุก ุญุณุจ ุงูููุงุฏ:**

"""
    
    for subject in subjects_summary:
        email += f"โข {subject['name']}: {subject['completed']}/{subject['total']} ({subject['rate']:.1f}%)\n"
    
    email += f"""

---

**ุงูุชูุตูุงุช:**

{recommendation}

---

ูุดูุฑ ุชุนุงูููู ุงููุณุชูุฑ ููุชุทูุน ูุฏุนููู ูู ุชุญููุฒ ุงูุทุงูุจ/ุฉ ุนูู ุงูุงูุชุฒุงู ุจุญู ุงูุชููููุงุช ุงูุฃุณุจูุนูุฉ.

ูุน ุฎุงูุต ุงูุชุญูุฉุ
ุฅุฏุงุฑุฉ ูุฏุฑุณุฉ ุนุซูุงู ุจู ุนูุงู ุงููููุฐุฌูุฉ
"""
    
    return email

